<!DOCTYPE html>
<html>
  <head>
    <title>Ionic navigation with Angular (Media Engineering Mobile Development)</title>
    <meta charset='utf-8'>
    <meta name='config' content='{&quot;basePath&quot;:&quot;../..&quot;,&quot;remark&quot;:{&quot;highlightLines&quot;:true,&quot;highlightSpans&quot;:true,&quot;countIncrementalSlides&quot;:false,&quot;navigation&quot;:{&quot;click&quot;:false,&quot;scroll&quot;:false,&quot;touch&quot;:true}},&quot;subjectUrl&quot;:&quot;https://github.com/MediaComem/comem-devmobil/tree/125012945183a0e955c808e36d7067edf160bfa3/subjects/ionic-angular/README.md&quot;}'>
  </head>
  <body>
    <textarea id='source'>
# Ionic navigation with Angular

Learn to work with [Angular][angular] in an [Ionic][ionic] project.

**Recommended reading**

* [Ionic](../ionic/)
* [Angular](../angular/)



---
## Scaffolding

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a>]

The `ionic` command comes with its own [scaffolding sub-command, `generate`][ionic-generate],
which can help you quickly generate new application elements:

> You should be located at the root of your project before using this command

```bash
$> ionic generate --help

  ionic generate - Automatically create framework features

    This command uses the Angular CLI to generate features such as pages, components, directives, services, etc.

    - For a full list of available types, use npx ng g --help
    - For a list of options for a types, use npx ng g <type> --help

    You can specify a path to nest your feature within any number of subdirectories.
    For example, specify a name of "pages/New Page" to generate page files at src/app/pages/new-page/.

    To test a generator before file modifications are made, use the --dry-run option
```
> Since `ionic generate` is based off the `Angular CLI`, you're advised to also take a look at [its own `generate` command documentation][ng-generate].

---
### Generate app pages

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a> > <a href="#2">Scaffolding</a>]

Using the `ionic generate page <PageName>` command, you can set up the necessary code to add new pages to you app.

> Use CamelCase for the name of your page in the command

From the root of your project, use the following command to set up a "Hello" page:

> Add `--dry-run` at the end of your `generate` command if you want to test what the command would do, without actually doing it.

```ts
$> `ionic generate page Hello`
> ng.cmd generate page Hello
CREATE src/app/hello/hello-routing.module.ts (343 bytes)
CREATE src/app/hello/hello.module.ts (465 bytes)
CREATE src/app/hello/hello.page.html (124 bytes)
CREATE src/app/hello/hello.page.spec.ts (640 bytes)
CREATE src/app/hello/hello.page.ts (252 bytes)
CREATE src/app/hello/hello.page.scss (0 bytes)
UPDATE src/app/app-routing.module.ts (497 bytes)
[OK] Generated page!
```

The Ionic CLI tells us that it's created a bunch of files, and updated one.

_Let's see what all of this means._

---
### What did `generate` do?

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a> > <a href="#2">Scaffolding</a>]

Here is what executing the command did in our project:

* Created a `hello.page.html` file to write your page's **HTML template** into,
* Created a `hello.page.scss` file to write your page's **style** into,
* Created a `hello.page.ts` file containing your page **class definition**, and referecing the previous `.html` and `.scss` files as your new page's template and style, respectively,
* Created a `hello.page.spec.ts` file to write your page's tests into (forget this for now, we'll see what tests in Angular are all about later on this course),
* Created a `hello.module.ts` file containing **a module that declares your new page** and how to navigate to it (more on this later),
* Created a `hello-routing.module.ts` file defining **the navigation for this new page**,
* Finally, updated the `app-routing.module.ts` file to **add your new page to your app's navigation**.

> Now is a good time to take a look at **how navigation's done in an Ionic/Angular app**.

---
## Navigation

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a>]

**Mobile applications** developed with [Ionic][ionic] and [Angular][angular] uses the [Angular router][angular-router] for navigation.

This router uses a **URL based system**, meaning that your app will display pages depending on the current URL state.

> Even though Ionic apps on mobile devices **don't show any address bars**, they do use URLs internally.

From the [Angular Router documentation][angular-router]:

> The browser is a familiar model of application navigation:
> * Enter a URL in the address bar and the browser navigates to a corresponding page.
> * Click links on the page and the browser navigates to a new page.
> * Click the browser's back and forward buttons and the browser navigates backward and forward through the history of pages you've seen.

With Ionic starter templates, base navigation is defined in the `app-routing.module.ts` file.

---
### Base navigation

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a> > <a href="#5">Navigation</a>]

The content of the `app-routing.module.ts` file for the **Blank Starter** (the simplest one with only one page) is as follow:

```ts
// imports omitted for brevity
* const routes: Routes = [
*   { path: '', redirectTo: 'home', pathMatch: 'full' },
*   {
*     path: 'home',
*     loadChildren: () => import('./home/home.module').then( m => m.HomePageModule)
*   }
* ];

@NgModule({
  imports: [
    `RouterModule.forRoot`(`routes`, { preloadingStrategy: PreloadAllModules })
  ],
  exports: [RouterModule]
})
export class AppRoutingModule { }
```
The `RouterModule.forRoot` method uses the `routes` constant to configure the `Router`'s top level navigation.

> We won't see what the second `forRoot` param is about, but you can learn more about it [here][how-to-lazy-load].

---
### Route definition (1/2)

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a> > <a href="#5">Navigation</a>]

Let's see how the routes are defined:

```ts
const routes: Routes = [
  { `path`: '', `redirectTo`: 'home', `pathMatch`: 'full' },
  {
    path: 'home',
    loadChildren: () => import('./home/home.module').then( m => m.HomePageModule)
  }
];
```
* `path` defines the URL path that, if matched, will trigger this route. A `path` of `''` means that this route is the default route, and is matched when there is no path in the URL (like with `https://example.com`).
  > _The path of the URL is the part that comes right after the domain name ; in a URL like `https://example.com/foo`, the path would be `foo`._
* `redirectTo` makes a route redirecting to another path. Here, the URL `https://example.com` will redirect to `https://example.com/home`, as if the user directly accessed it.
* `pathMatch: full` is required with `redirectTo` and means that only URLs with the exact same path as the one defined for this route will match.

---
### Route definition (2/2)

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a> > <a href="#5">Navigation</a>]

Let's (continue to) see how the routes are defined:

```ts
const routes: Routes = [
  { path: '', redirectTo: 'home', pathMatch: 'full' },
  {
    path: 'home',
    `loadChildren`: () => import('./home/home.module').then( m => m.HomePageModule)
  }
];
```
`loadChildren` is used to **Lazy Load** modules, meaning that modules will only be loaded when they are requested by the user's action, instead of at the app's startup. This is a _Good Practiceâ„¢_, as it **speeds up** the start of your app (with the downside of minor loads when first accessing the Lazy Loaded module).

Here, any URL with a path that starts with `home` will make Angular loads the `HomePageModule`. This module **MUST** have its own routes array so that the Router can keep searching for a match with what remains of the initial path.

Let's see how the `HomePageModule` is defined to better understand what we're talking about.

---
### HomePageModule

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a> > <a href="#5">Navigation</a>]

The code for the `HomePageModule` in the starter is as follows:

```ts
// Other imports...
*import { HelloPageRoutingModule } from './hello-routing.module';

import { HelloPage } from './hello.page';

@NgModule({
  imports: [
    CommonModule,
    FormsModule,
    IonicModule,
    `HelloPageRoutingModule`
  ],
  declarations: [HelloPage]
})
export class HelloPageModule {}
```

We can see that the `HomePageModule` imports another module named `HelloPageRoutingModule`. The name is obviously related to routing, and so navigation.

Let's see what's inside

---
#### HomePageRoutingModule

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a> > <a href="#5">Navigation</a> > <a href="#9">HomePageModule</a>]

This module is the equivalent of the `app-routing.module.ts` file, but for our new `HelloPage`. It's content should be as follows:

```ts
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';
import { HelloPage } from './hello.page';

*const routes: Routes = [
*  { path: '', component: HelloPage }
*];

@NgModule({
  imports: [RouterModule.`forChild`(routes)],
  exports: [RouterModule],
})
export class HelloPageRoutingModule {}

```

* The only route defined in this module means that when the remaining path starts with `''` (i.e. nothing), then the `HomePage` should be rendered.
* Note the usage of the `forChild` method when importing the `RouterModule`, instead of `forRoot`. This is necesseray to indicate that the `routes` of the `HomePageRoutingModule` are child routes.

---
### URL matching (1/3)

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a> > <a href="#5">Navigation</a>]

Now, suppose a user tries to access the URL `https://example.com/`.

The path that the router will try to match is `''`, since there is nothing after the domain name in our URL.

Looking at the root routes (in `app-routing.module.ts`), the Router will find a match:

```ts
{ path: '', redirectTo: 'home', pathMatch: 'full' }
```

This route will redirect the user to `https://example.com/home`, causing the router to start again and try and match this new URL using its path, which is now `home`.

---
### URL matching (2/3)

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a> > <a href="#5">Navigation</a>]

Looking again at the root routes, the Router will find a match for the new path `home`:

```ts
{
  path: 'home',
  loadChildren: () => import('./home/home.module').then( m => m.HomePageModule)
}
```
This route will make Angular loads the `HomePageModule`, which imports the `HomePageRoutingModule` that declares its child routes.

Now that it matched a route, the router will remove this route's path, `home`, from the path its trying to match, which is also `home`, leaving a remaining path of `''` to match with one of the child routes in the `HomePageRoutingModule`.

---
### URL matching (3/3)

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a> > <a href="#5">Navigation</a>]

Looking through the `HomePageRoutingModule` child routes for a match to the path `''`, the router will find one:

```ts
{ path: '', component: HomePage }
```

This route causes the `HomePage` component to be rendered and displayed to the user, effectively stopping the router's quest for a match to the URL `https://example.com/home`.

---
## Navigating to a page

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a>]

Let's add a new page to our app to see how we can navigate from one to the other.

From the root of your project, execute this command:

```bash
$> ionic generate page User
```

This generates a new page component in `src/app/user`, and update the root routes to include this new page in `app-routing.module.ts`:

```ts
const routes: Routes = [
  { path: '', redirectTo: 'home', pathMatch: 'full' },
  {
    path: 'hello',
    loadChildren: () => import('./hello/hello.module').then(m => m.HelloPageModule)
  },
* {
*   path: 'user',
*   loadChildren: () => import('./user/user.module').then(m => m.UserPageModule)
* }
];
```

---
### Link to other page

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a> > <a href="#14">Navigating to a page</a>]

We will add a button in our `HomePage` that allow our users to navigate to the `UserPage`.

To do so, let's open the `home.page.html` file and add some content:

```html
<!-- Other HTML -->
<ion-content padding>
  <p>Welcome to the Home Page</p>
  <ion-button `routerLink="/user"`>Go to User Page</ion-button>
</ion-content>
```
We added an Ionic [`ion-button`][ionic-button] tag with a [`routerLink`][angular-router-link] attribute.

This attribute is related to the Angular Router and allows the element to which it is attached to **make the app navigate to the given relative URL** when clicked by the user.

Provided that our app is accessible at `https://example.com`, clicking this new button will make our app navigate to `https://example.com/user`, ultimately displaying the `UserPage` component to our user.

---
## Nested pages

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a>]

Until now, all our pages where accessible with a simple path: `home`, `user`.

Let's say we want to add a `ProfilePage` as a child to our `UserPage`, and make it accessible through the `/user/profile` URL.

We could try to use once again the `ionic generate page` command. Let's do this with the `--dry-run` parameter to see if it does what we want:

```bash
$> `ionic generate page Profile --dry-run`
> ng.cmd generate page Profile --dry-run
CREATE `src/app`/profile/profile-routing.module.ts (351 bytes)
CREATE `src/app`/profile/profile.module.ts (479 bytes)
CREATE `src/app`/profile/profile.page.html (126 bytes)
CREATE `src/app`/profile/profile.page.spec.ts (654 bytes)
CREATE `src/app`/profile/profile.page.ts (260 bytes)
CREATE `src/app`/profile/profile.page.scss (0 bytes)
*UPDATE src/app/app-routing.module.ts (735 bytes)

NOTE: The "dryRun" flag means no changes were made.
```
We see that this new page would be created in the `src/app` directory, and a new route would be added to the `app-routing.module.ts` file at the root level.

This is not what we want...

---
### Generate page in specific path

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a> > <a href="#16">Nested pages</a>]

We'd like to create the files for this new `ProfilePage` under the `src/app/user` directory, since it's a **child page** of the user page.

To do so, we can add a path before the name of our page when executing the `generate` command:

```bash
$> ionic generate page `user/`Profile --dry-run
```
> Notice that the path added before our page's name is relative to the `src/app` folder.

---
#### That's it!

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a> > <a href="#16">Nested pages</a> > <a href="#17">Generate page in specific path</a>]

The result of the command is:

```bash
$> `ionic generate page user/Profile --dry-run`
> ng.cmd generate page user/Profile --dry-run
CREATE src/app/user/profile/profile-routing.module.ts (351 bytes)
CREATE src/app/user/profile/profile.module.ts (479 bytes)
CREATE src/app/user/profile/profile.page.html (126 bytes)
CREATE src/app/user/profile/profile.page.spec.ts (654 bytes)
CREATE src/app/user/profile/profile.page.ts (260 bytes)
CREATE src/app/user/profile/profile.page.scss (0 bytes)
UPDATE src/app/user/user-routing.module.ts (581 bytes)

NOTE: The "dryRun" flag means no changes were made.
```

The location of our files is correct, and the `user-routing.module.ts` has been updated.

Everything looks good, we can execute the command without the `--dryRun` param:

```bash
$> ionic generate page user/Profile
```

---
### Check the paths

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a> > <a href="#16">Nested pages</a>]

First, open the `user/user-routing.module.ts` file and look at the `routes` constant:

```ts
const routes: Routes = [
  { path: '', component: UserPage },
  `{ path: 'profile', loadChildren: () => import('./profile/profile.module').then( m => m.ProfilePageModule) }`
];
```
Then, open the `user/profile/profile-routing.module.ts` file:

```ts
// imports omitted for brevity
const routes: Routes = [
* { path: '', component: ProfilePage }
];

@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class ProfilePageRoutingModule {}
```
We should be able to access this new page through `https://example.com/user/profile`, or a button in the `UserPage` template.

---
## "Catch all" route

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a>]

It's possible to set special values to the `path` property of a `Route` object.

You could for example declare a route in your `app-routing.module.ts` (or any other module, for that matter), that would match **anything that hasn't matched** any preceding route.

This could be useful to set up a fallback page, like a **404 page**.

Do this by setting the `path` to the special value `**` (which means "everything"):

```ts
const routes: Routes = [
  { path: '', redirectTo: 'home', pathMatch: 'full' },
  { path: 'hello', loadChildren: () => import('./hello/hello.module').then(m => m.HelloPageModule) },
  { path: 'user', loadChildren: () => import('./user/user.module').then(m => m.UserPageModule) },
* { path: '**', component: ErrorPage }
];
```
This way, URLs that don't start with `/home` or `/user` wil display the `ErrorPage`.

> Remember that the order in which the routes are declared is important. If the highlighted route was in **first position**, all URLs would match its `path`, and nothing beside the `ErrorPage` would ever be displayed.

---
## Path placeholder

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a>]

It's also possible to declare dynamic routes, whose `path` value is not know beforehand.

This could be the case if you want to display e.g. a product detail page with URL like those:

* `https://example.com/product/12`
* `https://example.com/product/817`
* `https://example.com/product/9`

All of them would display the same "page", with the relevant content depending on the product `id` in the URL.

You can declare this kind of route like so:

```ts
{ path: 'product/:id', component: ProductDetailPage }
```
The `:id` token in the `path` value declares a path parameter that you can access in your component's code, and whose value will be the value in the URL (`12`, `817` or `9` in the above examples)

---
### Access path parameter

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a> > <a href="#21">Path placeholder</a>]

To access this `:id` path parameter from your code, you'll need to inject the [`ActivatedRoute`][angular-activated-route] service in your component's controller, and subscribe to its `paramMap` **observable** (this is not a synchronous operation!):

```ts
// imports omitted for brevity
@Component({ /* ... */ })
export class ProductPage  {

  productId: any;

  constructor(
*   private route: ActivatedRoute
  ) {
*   this.route.paramMap.subscribe((params: ParamMap) => {
*     this.productId = params.get('id');
*   });
  }
}
```
> The value passed to `params.get` must be **the name of the param** as declared in the route's path, **without** the `:`.

> In this case `params.get('id')` and **not** `params.get(':id')`.

---
### Link to parametrized path

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a> > <a href="#21">Path placeholder</a>]

If you want to link to such a route from your templates, you can still use the [`routerLink`][angular-router-link] attribute, but will need to use another notation:

```html
<ion-button `[routerLink]="['/product', product.id]"`>
  {{ product.name }} Details
</ion-button>
```
You could also make the navigation from your component's code by injecting the [`Router`][angular-router-class] service in your component's controller:

```ts
export class ExamplePage {
  product: any;

  constructor(private router: Router) {
    this.product = await getProductOneWayOrAnother();
  }

  goToSimpleRoute() {
*   this.router.navigateByUrl('/home');
  }

  goToParametrizedRoute() {
*   this.router.navigate([ '/product', this.product.id ]);
  }
}
```

---
## Lifecycle hooks

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a>]

Any component may implement any of these [lifecycle methods][ionic-page-event] to be notified of navigation events:

Method              | Called when
:---                | :---
`ionViewWillEnter`  | The targeted page is about to animate into view and become the active page.
`ionViewDidEnter`   | The targeted page has finished animating into view and is now the active page. This event will fire, whether it was the first load or a cached page.
`ionViewWillLeave`  | The current page is about to animate out of view and no longer be the active page.
`ionViewDidLeave`   | The current page has finished animating out of view and is no longer the active page.

---
## Guarding routes

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a>]

Angular also provides you with a mean of preventing unauthorized accesses to routes by using services called `Guard`.

This is usefull for example if your app implements **authentication** and you want to prevent unauthenticated access to restricted pages.

A Guard is simply an Angular service implementing the [`CanActivate` interface][angular-can-activate]:

```ts
// random-access.ts
// imports omitted for brevity
@Injectable({ providedIn: 'root' })
export class RandomAccessGuard implements CanActivate {

* canActivate(next: ActivatedRouteSnapshot, state: RouterStateSnapshot): boolean {
*   const value = Math.random();
*   return value >= 0.5 ? true : false;
* }
}
```
You can then use this Guard with the [`canActivate`][angular-route-can-activate] property of your route:

```ts
{ path: 'admin', `canActivate: [ RandomAccessGuard ]`, component: AdminPage }
```
> `canActivate` takes an array of one or more Guards

---
## Resources

.breadcrumbs[<a href="#1">Ionic navigation with Angular</a>]

**Documentation**

* [Ionic][ionic-docs]
  * [Navigation][ionic-nav-tutorial]
* [Angular][angular-docs]
  * [Routing & Navigation tutorial][angular-routing-navigation]
  * [Route Guard (french) tutorial][angular-route-guard]

[angular]: https://angular.io
[angular-activated-route]: https://angular.io/api/router/ActivatedRoute
[angular-can-activate]: https://angular.io/api/router/CanActivate
[angular-docs]: https://angular.io/docs
[angular-route-can-activate]: https://angular.io/api/router/Route#canActivate
[angular-route-guard]: https://guide-angular.wishtack.io/angular/routing/route-guards
[angular-router]: https://angular.io/guide/router
[angular-router-class]: https://angular.io/api/router/Router
[angular-router-link]: https://angular.io/api/router/RouterLink
[angular-routing-navigation]: https://angular.io/guide/router#routing--navigation
[how-to-lazy-load]: https://blog.ionicframework.com/how-to-lazy-load-in-ionic-angular/
[ionic]: http://ionicframework.com
[ionic-button]: https://ionicframework.com/docs/api/button
[ionic-docs]: https://ionicframework.com/docs/
[ionic-nav-tutorial]: https://ionicframework.com/docs/angular/navigation
[ionic-generate]: https://ionicframework.com/docs/cli/commands/generate
[ionic-page-event]: https://ionicframework.com/docs/angular/lifecycle#ionic-page-events
[ng-route]: https://angular.io/api/router/Route
[ng-generate]: https://angular.io/cli/generate

    </textarea>
    <script src='https://embed.runkit.com'></script>
    <script src='../../subject-413f9bacf582e4958832.js'></script>
  </body>
</html>
